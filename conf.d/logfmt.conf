<match kubernetes.**>
  @type rewrite_tag_filter
  <rule>
    key     kubernetes.labels.logformat
    pattern /^logfmt$/
    tag     logfmt.*
  </rule>
  <rule>
    key     kubernetes.labels.logformat
    pattern /^logfmt$/
    tag     *
    invert  true
  </rule>
</match>

<filter logfmt.**>
  @type parser
  key_name log
  format logfmt
  reserve_data true
</filter>